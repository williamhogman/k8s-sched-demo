FROM golang:1.23-alpine AS builder

# Set working directory
WORKDIR /build

# Copy just the Go module files first for better caching
COPY go.mod go.sum ./
RUN go mod download

# Copy the source code
COPY . .

# Build the scheduler binary
RUN cd scheduler/cmd/server && \
    go build -o /build/app .

# Final lightweight image
FROM gcr.io/distroless/static-debian12

COPY --from=builder /build/app /app

EXPOSE 50051

ENTRYPOINT ["/app"] 