if ! has nix_direnv_version || ! nix_direnv_version 2.2.1; then
  source_url "https://raw.githubusercontent.com/nix-community/nix-direnv/2.2.1/direnvrc" "sha256-zelF0vLbEl5uaqrfIzbgNzJWGmLzCmYAkInj/LNxvKs="
fi

# Watch files that should trigger a reload when changed
watch_file flake.nix
watch_file flake.lock
watch_file .envrc.local

# Load flake-based environment
use flake

# Load local customizations if they exist
if [ -f .envrc.local ]; then
  source_env .envrc.local
fi

# Ensure we have a proper shell
if ! has go; then
  log_error "Go is not available in your environment. Did the nix flake load correctly?"
  exit 1
fi

# Print success message on load
log_status "Go $(go version | awk '{print $3}') is active" 